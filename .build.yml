image: alpine/latest
packages:
  - rsync
  - hugo
sources:
  - git@github.com:manu-cyber/c3stoc-website.git
secrets:
  - 02e75aca-3e7d-4356-b2c8-129e1ead2b34
tasks:
  - build: |
      cd c3stoc-website
      hugo
  - deploy: |
      cd c3stoc-website
      if [ "$(git rev-parse origin/main)" == "$(git rev-parse HEAD)" ] ; then
        sshopts="ssh -o StrictHostKeyChecking=no"
        rsync --rsh="$sshopts" -rP --del --force public irimi1@wirtanen.uberspace.de:/var/www/virtual/irimi1/stickeroperation.center/
       else
         echo "Not the 'main' branch, skipping deployment"
       fi
